<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Asset Barcode Scanner</title>
<script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
</head>
<body>

<h2>Asset Management Barcode Scanner</h2>

<div id="reader" style="width: 300px;"></div>

<table id="assetTable" border="1">
  <thead>
    <tr>
      <th>Asset Name</th>
      <th>Barcode</th>
      <th>Timestamp</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>

<button id="downloadCsv">Download CSV</button>

<script>
let scannedData = [];

function onScanSuccess(decodedText, decodedResult) {
    console.log(`Barcode scanned: ${decodedText}`);
    
    let assetName = prompt("Enter Asset Name:", "Asset");
    let timestamp = new Date().toLocaleString();
    
    scannedData.push({name: assetName, barcode: decodedText, time: timestamp});

    // Add to table
    const tbody = document.querySelector("#assetTable tbody");
    const row = tbody.insertRow();
    row.insertCell(0).innerText = assetName;
    row.insertCell(1).innerText = decodedText;
    row.insertCell(2).innerText = timestamp;
}

function startScanner() {
    const html5QrCode = new Html5Qrcode("reader");
    html5QrCode.start(
        { facingMode: "environment" }, 
        {
            fps: 10,
            qrbox: 250
        },
        onScanSuccess
    );
}

startScanner();

// CSV download
document.getElementById("downloadCsv").addEventListener("click", () => {
    let csvContent = "Asset Name,Barcode,Timestamp\n";
    scannedData.forEach(item => {
        csvContent += `${item.name},${item.barcode},${item.time}\n`;
    });

    const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "assets.csv";
    a.click();
});
</script>

</body>
</html>
