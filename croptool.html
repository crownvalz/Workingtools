<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Passport Photo AI</title>
    <meta content="A modern and secure passport photo cropping tool." name="description">
    <meta content="passport, photo, crop, secure, tool" name="keywords">

    <!-- Favicons -->
    <link href="assets/img/tree.png" rel="icon">
    <link href="assets/img/tree.png" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Cropper.js CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" rel="stylesheet">
    <!-- Face-api.js CDN -->
    <script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="flex h-screen bg-gray-100">

    <!-- Sidebar -->
    <div class="sidebar bg-white w-80 p-6 flex flex-col space-y-6 shadow-lg rounded-xl ml-6 mt-6 mb-4 transition-all duration-300 ease-in-out">
        <h1 class="logo text-2xl font-bold text-gray-800 mb-6">Safeme Plc</h1>
        <div class="boxed bg-white p-4 rounded-lg shadow-sm border border-gray-200">
            <nav class="space-y-4">
                <a href="#" class="flex items-center text-gray-700 px-4 py-2 rounded-md hover:bg-blue-100 hover:text-blue-500">
                    <i class="fas fa-project-diagram mr-4"></i>Projects
                </a>
                <a href="#" class="flex items-center text-gray-700 px-4 py-2 rounded-md hover:bg-blue-100 hover:text-blue-500">
                    <i class="fas fa-users mr-4"></i>My Organization
                </a>
                <div class="dropdown relative">
                    <a href="#" class="flex items-center text-gray-700 px-4 py-2 rounded-md hover:bg-blue-100 hover:text-blue-500">
                        <i class="fas fa-cogs mr-4"></i>Settings
                    </a>
                    <div class="dropdown-content absolute left-0 w-full bg-blue-50 rounded-lg mt-2 hidden shadow-lg">
                        <a href="#" class="block text-gray-700 px-6 py-2 hover:bg-blue-100">Profile Settings</a>
                        <a href="#" class="block text-gray-700 px-6 py-2 hover:bg-blue-100">Account Settings</a>
                        <a href="#" class="block text-gray-700 px-6 py-2 hover:bg-blue-100">Privacy Settings</a>
                    </div>
                </div>
                <a href="https://digital.azaniabank.co.tz/onboard/#/login-rm" class="flex items-center text-gray-700 px-4 py-2 rounded-md hover:bg-blue-100 hover:text-blue-500">
                    <i class="fas fa-phone mr-4"></i>Digital Onboarding
                </a>
                <a href="#" class="flex items-center text-gray-700 px-4 py-2 rounded-md hover:bg-blue-100 hover:text-blue-500">
                    <i class="fas fa-book mr-4"></i>Resources
                </a>
                <a href="#" class="flex items-center text-gray-700 px-4 py-2 rounded-md hover:bg-blue-100 hover:text-blue-500">
                    <i class="fas fa-comments mr-4"></i>Community
                </a>
            </nav>
        </div>
        <div class="boxed bg-white p-4 rounded-lg shadow-sm border border-gray-200 mt-auto flex items-center space-x-4">
            <img src="assets/img/wei.png" alt="User" class="w-9 h-9 rounded-full">
            <div>
                <div class="text-sm font-medium text-gray-800">Dady Tee</div>
                <small class="text-xs text-gray-500">crownvalz@gmail.com</small>
            </div>
        </div>
    </div>

    <!-- Navbar and Main Content -->
    <div class="flex-1 flex flex-col w-full">
        <!-- Top Navbar -->
        <div class="navbar-top bg-white flex items-center justify-between p-6 shadow-lg rounded-t-xl mt-6 mb-4 mx-4">
            <div class="search-bar flex items-center space-x-4">
                <button class="bg-transparent border border-gray-300 rounded-lg p-2">
                    <i class="fas fa-cog"></i>
                </button>
                <input type="text" class="border border-gray-300 rounded-lg p-2 w-64 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Search...">
            </div>
            <div class="icons flex space-x-4">
                <button class="p-2 border border-gray-300 rounded-lg hover:bg-blue-100 hover:text-blue-500">
                    <i class="fas fa-bell"></i>
                </button>
                <button class="p-2 border border-gray-300 rounded-lg hover:bg-blue-100 hover:text-blue-500">
                    <i class="fas fa-user"></i>
                </button>
                <button class="p-2 border border-gray-300 rounded-lg hover:bg-blue-100 hover:text-blue-500">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>
        <div class="content p-6 flex-1 overflow-y-auto">
            <h2 class="text-2xl font-semibold mb-4">Dashboard</h2>
            <p>Your dashboard content goes here...</p>
            <!-- Add more content as needed -->




            <div class="container mx-auto px-4 py-10 flex flex-col items-center">
                <h1 class="text-2xl font-semibold mb-4">Make a Passport Photo</h1>
                <button type="button" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-700" onclick="openModal()">
                    <i class="fas fa-upload"></i>
                </button>
        
                <!-- Crop Modal -->
                <div id="cropModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center">
                    <div class="bg-white rounded-lg shadow-lg w-full max-w-2xl">
                        <div class="p-4 border-b flex justify-between items-center">
                            <h5 class="text-lg font-semibold">Crop Your Photo</h5>
                            <button class="text-gray-400 hover:text-gray-600" onclick="closeModal()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="p-4">
                            <input type="file" class="w-full border-gray-300 rounded" id="imageUpload" accept="image/*" required>
                            <small class="text-gray-500">Upload a clear photo for best results.</small>
                            <div class="mt-4 flex justify-center">
                                <img id="imageToCrop" src="" alt="To Crop">
                            </div>
                        </div>
                        <div class="flex justify-center gap-4 p-4 border-t">
                            <button type="button" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-700" onclick="applyCrop()">Crop & Save</button>
                            <button type="button" class="bg-gray-300 text-black px-4 py-2 rounded hover:bg-gray-400" onclick="closeModal()">Cancel</button>
                        </div>
                    </div>
                </div>
        
                <!-- Preview and Form -->
                <div id="previewContainer" class="hidden mt-8 p-8 sm:p-10 md:p-12 border border-gray-300 rounded-lg bg-white shadow-lg w-full max-w-3xl mx-auto">
                    <h5 class="text-center font-semibold text-xl sm:text-2xl mb-4">Cropped Image Preview</h5>
                    <img id="croppedImagePreview" src="" alt="Cropped Preview" class="my-4 w-full max-w-xs sm:max-w-sm md:max-w-md mx-auto">
                    <div class="flex justify-center">
                        <button class="bg-gray-400 text-white px-6 py-3 rounded-lg hover:bg-gray-500" onclick="recropImage()">Crop Again</button>
                    </div>
                    <form id="photoForm" class="mt-6">
                        <div>
                            <label for="nameField" class="block text-sm font-medium">Name (Optional)</label>
                            <input type="text" id="nameField" class="mt-2 block w-full border-gray-300 rounded-lg shadow-sm" placeholder="Enter a name for the PDF file">
                        </div>
                        <div class="mt-6">
                            <label for="photoCount" class="block text-sm font-medium">Number of Photos</label>
                            <input type="number" id="photoCount" value="1" min="1" max="20" required class="mt-2 block w-full border-gray-300 rounded-lg shadow-sm">
                        </div>
                        <button type="button" class="bg-blue-500 text-white mt-6 w-full py-3 rounded-lg hover:bg-blue-700" onclick="generatePDF()">
                            Generate PDF
                        </button>
                    </form>
                </div>




        </div>
    </div>
    <script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>

    <script>
        async function loadModels() {
            await faceapi.nets.ssdMobilenetv1.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js/weights');
            await faceapi.nets.faceLandmark68Net.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js/weights');
            await faceapi.nets.faceRecognitionNet.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js/weights');
        }
    </script>
    <script>
        let cropper;
        let croppedImageDataURL;
        const imageToCrop = document.getElementById("imageToCrop");
        const croppedImagePreview = document.getElementById("croppedImagePreview");
        const previewContainer = document.getElementById("previewContainer");

        // Handle image upload and initialize cropper
        document.getElementById("imageUpload").addEventListener("change", (e) => {
            const file = e.target.files[0];
            if (file && file.size <= 5 * 1024 * 1024) { // Limit file size to 5 MB
                const reader = new FileReader();
                reader.onload = (event) => {
                    initializeCropper(event.target.result);
                    detectFace(event.target.result);
                };
                reader.readAsDataURL(file);
            } else {
                alert("Please upload a valid image file under 5 MB.");
            }
        });

        // Load Face-api.js models
        async function loadModels() {
            await faceapi.nets.ssdMobilenetv1.loadFromUri('/models');
            await faceapi.nets.faceLandmark68Net.loadFromUri('/models');
            await faceapi.nets.faceRecognitionNet.loadFromUri('/models');
        }

        // Initialize cropper with image and auto-set face detection
        function initializeCropper(imageSrc) {
            imageToCrop.src = imageSrc;
            imageToCrop.style.display = "block";
            if (cropper) cropper.destroy();
            cropper = new Cropper(imageToCrop, {
                aspectRatio: 4 / 5,
                scalable: true,
                zoomable: true,
                viewMode: 1,
            });
        }

        // Detect face using Face-api.js
        async function detectFace(imageSrc) {
            await loadModels();
            const img = document.createElement('img');
            img.src = imageSrc;
            img.onload = async () => {
                const detections = await faceapi.detectSingleFace(img).withFaceLandmarks();
                if (detections) {
                    const { x, y, width, height } = detections.detection.box;
                    cropper.setCropBoxData({ left: x, top: y, width: width, height: height });
                }
            };
        }

        // Apply crop
        function applyCrop() {
            const croppedCanvas = cropper.getCroppedCanvas({ width: 200, height: 250 });
            croppedImageDataURL = croppedCanvas.toDataURL("image/jpeg");
            croppedImagePreview.src = croppedImageDataURL;
            previewContainer.style.display = "block";
            cropper.destroy();
            closeModal(); // Close the modal after cropping
        }

        // Recrop the image
        function recropImage() {
            initializeCropper(croppedImageDataURL);
            openModal();
        }

        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('portrait', 'mm', 'a4');
            const imgWidth = 35;
            const imgHeight = 45;
            const margin = 8;
            const docWidth = 210;
            const docHeight = 297;

            const photoCount = parseInt(document.getElementById("photoCount").value);
            let x = margin;
            let y = margin;

            for (let i = 0; i < photoCount; i++) {
                if (y + imgHeight + margin > docHeight) {
                    alert("Reached maximum number of images for a single A4 page.");
                    break;
                }
                if (x + imgWidth + margin > docWidth) {
                    x = margin;
                    y += imgHeight + margin;
                }
                doc.addImage(croppedImageDataURL, 'JPEG', x, y, imgWidth, imgHeight);
                x += imgWidth + margin;
            }

            doc.setFontSize(10);
            doc.text("© 2024 Secure Passport Photo Tool by Mono. All Rights Reserved.", docWidth / 2, docHeight - 10, null, null, 'center');

            const fileName = document.getElementById("nameField").value || "passport_photos";
            doc.save(`${fileName}.pdf`);
        }

        // Open and close modal
        function openModal() {
            document.getElementById("cropModal").classList.remove("hidden");
        }

        function closeModal() {
            document.getElementById("cropModal").classList.add("hidden");
        }
    </script>
</body>
</html>